# Vibecraft ‚Äî implement_skill / implement

---
## Your Role

# Agent: Implementer

## Role
You write implementation code that makes existing tests pass.
You work on **Research: Asteroids Game**.

## Stack
- **tech_stack**: Asteroids Game
- **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ_–Ω–∞_—Å–ª–æ–∏**: Domain ‚Üí Application ‚Üí Infrastructure ‚Üí Presentation
- **–ø—Ä–∞–≤–∏–ª–∞_tdd**: **
- **‚îÇ__(entities**: Ship, Asteroid, Bullet)     ‚îÇ
- **testenvironment**: 'jsdom',
- **modulefileextensions**: ['js'],
- **testmatch**: ['**/test/**/*.test.js'],
- **coveragedirectory**: 'coverage',
- **collectcoveragefrom**: ['src/**/*.js']
- **npm_run_test**: coverage

## Sacred Rules ‚ö†Ô∏è
1. **You NEVER modify files inside `src/tests/`** ‚Äî they are immutable
2. If a test seems incorrect, you **FLAG it** with a comment ‚Äî you do not fix it
3. You write the minimum code needed to make tests pass (no over-engineering)
4. You follow the architecture defined in `docs/design/architecture.md`
5. You follow the stack from `docs/stack.md` ‚Äî no introducing new dependencies without flagging

## Flagging Issues
If you encounter a problem with a test, respond with:
```
‚ö†Ô∏è FLAG: src/tests/[file] ‚Äî [describe the issue]
Suggested resolution: [your suggestion]
Awaiting human decision before proceeding.
```

## Implementation Principles
- Follow the architecture pattern (Clean Architecture)
- No business logic in infrastructure layer
- Dependency injection over hard coupling
- All side effects isolated and injectable
- No `any` types (if TypeScript)

## Output
- Files in: `src/`
- Do NOT create files in `src/tests/`
- After completing, list:
  - Files created/modified
  - Tests that now pass
  - Any flags raised

## On Completion
End your response with:
```
IMPLEMENTATION COMPLETE
Files modified: [list]
Tests passing: [list]
Flags raised: [list or "none"]
Ready for code review.
```

---
## Project Context

# Project: Research: Asteroids Game
> Generated by Vibecraft | Phase: **implement** | 2026-02-25 22:51 UTC

---

## Stack Summary
- **tech_stack**: Asteroids Game
- **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ_–Ω–∞_—Å–ª–æ–∏**: Domain ‚Üí Application ‚Üí Infrastructure ‚Üí Presentation
- **–ø—Ä–∞–≤–∏–ª–∞_tdd**: **
- **‚îÇ__(entities**: Ship, Asteroid, Bullet)     ‚îÇ
- **testenvironment**: 'jsdom',
- **modulefileextensions**: ['js'],
- **testmatch**: ['**/test/**/*.test.js'],
- **coveragedirectory**: 'coverage',
- **collectcoveragefrom**: ['src/**/*.js']
- **npm_run_test**: coverage

---

## Progress

- [x] research
- [x] design
- [x] plan
- [ ] **implement** ‚Üê CURRENT
- [ ] review

---

## Agents Available

- `researcher`
- `architect`
- `planner`
- `plan_reviewer`
- `pre_checker`
- `tdd_writer`
- `implementer`
- `code_reviewer`
- `performance_optimizer`
- `game_designer`
- `security_auditor`
- `api_designer`

---

## Architecture Decisions (ADR)

- ADR-001: Vanilla JavaScript Without Frameworks
- ADR-002: Clean Architecture with 4 Layers
- ADR-003: TDD with Jest and jsdom
- ADR-004: Fixed Timestep Game Loop
- ADR-005: Canvas 2D API for Rendering
- ADR-006: ES Modules for Code Organization
- ADR-007: Object Pooling for Bullets and Asteroids
- ADR-008: localStorage for High Scores
- ADR-009: Event-Based Input Handling
- ADR-010: Collision Detection with Circle Approximation

---

## Immutable Contracts

- Tests in `src/tests/` are **locked** after tdd_writer approval ‚Äî implementer must never modify them
- ADR decisions are final unless a new ADR explicitly overrides
- Stack decisions from `docs/stack.md` apply to all agents

---

## How to Continue in a New Chat

**Option A ‚Äî automatic:**
```bash
vibecraft context --skill <skill_name>
```
Copies this file + the skill prompt to clipboard. Paste at the start of your Qwen chat.

**Option B ‚Äî manual, attach these files:**
1. `docs/context.md` ‚Üê this file
2. `.vibecraft/skills/<current_skill>.yaml`
3. `.vibecraft/agents/<relevant_agent>.md`
4. `docs/plans/phase_<N>.md`

---
_Vibecraft v0.1 ‚Äî https://github.com/you/vibecraft_

---
## Stack

# Tech Stack: Asteroids Game

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –Ø–∑—ã–∫ –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|------------|--------|
| **–Ø–∑—ã–∫** | JavaScript (ECMAScript) | ES2022+ |
| **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞** | –í–µ–±-–±—Ä–∞—É–∑–µ—Ä | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã |
| **–°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** | Vanilla JS (–±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤) | ‚Äî |

---

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Clean Architecture)**
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏: Domain ‚Üí Application ‚Üí Infrastructure ‚Üí Presentation
  - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å (–∫ –¥–æ–º–µ–Ω—É)
- **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã**
  - Single Responsibility, Open/Closed, Liskov Substitution, Interface Segregation, Dependency Inversion
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥**
  - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å —á—ë—Ç–∫–∏–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
- **TDD (Test-Driven Development)**
  - –ö—Ä–∞—Å–Ω—ã–π ‚Üí –ó–µ–ª—ë–Ω—ã–π ‚Üí –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
  - –¢–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –î–û —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
  - 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π

### TDD –ø—Ä–æ—Ü–µ—Å—Å

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   RED       ‚îÇ     ‚îÇ   GREEN     ‚îÇ     ‚îÇ  REFACTOR   ‚îÇ
‚îÇ  Write test ‚îÇ ‚îÄ‚îÄ‚ñ∫ ‚îÇ  Make it    ‚îÇ ‚îÄ‚îÄ‚ñ∫ ‚îÇ  Clean up   ‚îÇ
‚îÇ  (fails)    ‚îÇ     ‚îÇ  pass       ‚îÇ     ‚îÇ  code       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñ≤                                       ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∞–≤–∏–ª–∞ TDD:**
1. –ù–µ –ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–∫–æ–¥ –±–µ–∑ –ø–∞–¥–∞—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞
2. –ü–∏—Å–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
4. –£–¥–∞–ª—è—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

### –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Presentation Layer              ‚îÇ
‚îÇ  (Canvas Renderer, Input Handler, UI)   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         Application Layer               ‚îÇ
‚îÇ  (Game Loop, State Management, Rules)   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           Domain Layer                  ‚îÇ
‚îÇ  (Entities: Ship, Asteroid, Bullet)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ        Infrastructure Layer             ‚îÇ
‚îÇ  (Storage, Audio, LocalStorage)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **Jest** | –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è unit- –∏ integration-—Ç–µ—Å—Ç–æ–≤ |
| **ES Modules** | –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
test/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ ship.test.js
‚îÇ   ‚îú‚îÄ‚îÄ asteroid.test.js
‚îÇ   ‚îî‚îÄ‚îÄ collision.test.js
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îú‚îÄ‚îÄ game-loop.test.js
‚îÇ   ‚îî‚îÄ‚îÄ state.test.js
‚îî‚îÄ‚îÄ infrastructure/
    ‚îî‚îÄ‚îÄ storage.test.js
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jest

```javascript
// jest.config.js
export default {
  testEnvironment: 'jsdom',
  moduleFileExtensions: ['js'],
  testMatch: ['**/test/**/*.test.js'],
  coverageDirectory: 'coverage',
  collectCoverageFrom: ['src/**/*.js']
};
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
asteroids/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Ship.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Asteroid.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Bullet.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UFO.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ value-objects/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Vector2D.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CollisionBox.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ CollisionDetector.js
‚îÇ   ‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Game.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameLoop.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameState.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ScoreManager.js
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Storage.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AudioController.js
‚îÇ   ‚îî‚îÄ‚îÄ presentation/
‚îÇ       ‚îú‚îÄ‚îÄ Renderer.js
‚îÇ       ‚îú‚îÄ‚îÄ InputHandler.js
‚îÇ       ‚îî‚îÄ‚îÄ UIController.js
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ styles.css
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ jest.config.js
‚îî‚îÄ‚îÄ README.md
```

---

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **npm** | –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ |
| **ESLint** | –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞ |
| **Prettier** | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ |
| **Vite** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | Dev-—Å–µ—Ä–≤–µ—Ä –∏ —Å–±–æ—Ä—â–∏–∫ |

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–¥—É

### –°—Ç–∏–ª—å –∫–æ–¥–∞

- **–ú–æ–¥—É–ª–∏ ES6** ‚Äî `import`/`export`
- **–ö–ª–∞—Å—Å—ã** ‚Äî –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–æ–º–µ–Ω–∞
- **–°—Ç—Ä–µ–ª–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî –¥–ª—è –∫–æ–ª–±—ç–∫–æ–≤
- **Const/Let** ‚Äî –±–µ–∑ `var`
- **Template literals** ‚Äî –¥–ª—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ —Å—Ç—Ä–æ–∫

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ

- **–ö–ª–∞—Å—Å—ã** ‚Äî PascalCase (`Ship`, `Asteroid`)
- **–§—É–Ω–∫—Ü–∏–∏/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** ‚Äî camelCase (`createAsteroid`, `gameState`)
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã** ‚Äî UPPER_CASE (`MAX_BULLETS`, `SHIP_SPEED`)
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–ª—è** ‚Äî `#privateField`

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- README —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
npm test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test:coverage

# –ó–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vite)
npm run dev

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm run build
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å |
|---------|------|
| **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** | > 80% |
| **ESLint –æ—à–∏–±–æ–∫** | 0 |
| **–†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞** | < 100 KB (minified) |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | 60 FPS –Ω–∞ —Ü–µ–ª–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö |

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –±–∞–∑–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- [ ] –ù–µ—Ç ESLint –æ—à–∏–±–æ–∫
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- [ ] –ö–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ —Å–ª–æ—è–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã


---
## Architecture

# Architecture: Asteroids Game

**Version:** 1.0  
**Status:** Accepted  
**Last Updated:** 2026-02-25  
**Phase:** Design

---

## üìã Overview

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏–≥—Ä—ã Asteroids, –∏—Å–ø–æ–ª—å–∑—É—è **C4 –º–æ–¥–µ–ª—å** (Context, Container, Component, Code) –∏ **Architecture Decision Records (ADR)** –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **Clean Architecture** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å –∫ –¥–æ–º–µ–Ω—É
2. **SOLID** ‚Äî –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID
3. **Testability First** ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç TDD
4. **Explicit Dependencies** ‚Äî –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —è–≤–Ω—ã–µ
5. **Single Responsibility** ‚Äî –æ–¥–∏–Ω –∫–ª–∞—Å—Å = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

---

## üèóÔ∏è C4 Model

### Level 1: System Context Diagram

```mermaid
C4Context
    title System Context Diagram ‚Äî Asteroids Game

    Person(player, "–ò–≥—Ä–æ–∫", "–ß–µ–ª–æ–≤–µ–∫, –∏–≥—Ä–∞—é—â–∏–π –≤ –∏–≥—Ä—É")
    System_Ext(browser, "–í–µ–±-–±—Ä–∞—É–∑–µ—Ä", "Chrome/Firefox/Safari/Edge —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ES2022+")
    
    System_Boundary(asteroids, "Asteroids Game") {
        System(game_system, "Asteroids Game", "–í–µ–±-–∏–≥—Ä–∞ –Ω–∞ Vanilla JavaScript")
    }

    Rel(player, browser, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(browser, game_system, "–ó–∞–ø—É—Å–∫–∞–µ—Ç –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç")

    UpdateRelStyle(player, browser, $offsetY="-30")
    UpdateRelStyle(browser, game_system, $offsetY="30")
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- **–ò–≥—Ä–æ–∫** –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å **–≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–æ–º**
- **–ë—Ä–∞—É–∑–µ—Ä** –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –∏–≥—Ä—ã
- **Asteroids Game** ‚Äî –µ–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

### Level 2: Container Diagram

```mermaid
C4Container
    title Container Diagram ‚Äî Asteroids Game

    Person(player, "–ò–≥—Ä–æ–∫", "–ß–µ–ª–æ–≤–µ–∫, –∏–≥—Ä–∞—é—â–∏–π –≤ –∏–≥—Ä—É")
    
    Container_Boundary(game_boundary, "Asteroids Game") {
        Container(ui, "UI Layer", "HTML/CSS/JS", "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –º–µ–Ω—é, HUD")
        Container(presentation, "Presentation Layer", "JavaScript", "–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Canvas, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞")
        Container(application, "Application Layer", "JavaScript", "–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø—Ä–∞–≤–∏–ª–∞")
        Container(domain, "Domain Layer", "JavaScript", "–°—É—â–Ω–æ—Å—Ç–∏: Ship, Asteroid, Bullet, UFO")
        Container(infrastructure, "Infrastructure Layer", "JavaScript", "Storage, Audio, LocalStorage")
    }

    Rel(player, ui, "–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç")
    Rel(ui, presentation, "–£–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º")
    Rel(presentation, application, "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–≤–æ–¥, –ø–æ–ª—É—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ")
    Rel(application, domain, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞")
    Rel(application, infrastructure, "–°–æ—Ö—Ä–∞–Ω—è–µ—Ç/–∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ")
    Rel(infrastructure, domain, "–°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏")

    UpdateRelStyle(player, ui, $offsetY="-40")
    UpdateRelStyle(ui, presentation, $offsetX="-60")
    UpdateRelStyle(presentation, application, $offsetX="60")
    UpdateRelStyle(application, domain, $offsetX="-60")
    UpdateRelStyle(application, infrastructure, $offsetX="60")
    UpdateRelStyle(infrastructure, domain, $offsetX="-60")
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|------------|-----------------|
| **UI Layer** | HTML/CSS | –ú–µ–Ω—é, HUD, —ç–∫—Ä–∞–Ω—ã Game Over/Pause |
| **Presentation Layer** | JavaScript + Canvas 2D API | –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ input |
| **Application Layer** | JavaScript | Game loop, GameState, ScoreManager |
| **Domain Layer** | JavaScript | Ship, Asteroid, Bullet, UFO, Vector2D |
| **Infrastructure Layer** | JavaScript + Web APIs | Storage, AudioController, LocalStorage |

---

### Level 3: Component Diagram

#### Domain Layer Components

```mermaid
C4Component
    title Domain Layer Components

    Container_Boundary(domain, "Domain Layer") {
        Component(ship, "Ship", "Entity", "–ò–≥—Ä–æ–∫: –ø–æ–∑–∏—Ü–∏—è, –≤—Ä–∞—â–µ–Ω–∏–µ, —Ç—è–≥–∞")
        Component(asteroid, "Asteroid", "Entity", "–ê—Å—Ç–µ—Ä–æ–∏–¥: —Ä–∞–∑–º–µ—Ä, —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è")
        Component(bullet, "Bullet", "Entity", "–õ–∞–∑–µ—Ä: –ø–æ–∑–∏—Ü–∏—è, lifetime")
        Component(ufo, "UFO", "Entity", "–ù–õ–û: AI, —Å—Ç—Ä–µ–ª—å–±–∞")
        Component(vector2d, "Vector2D", "Value Object", "2D –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ñ–∏–∑–∏–∫–∏")
        Component(collision, "CollisionBox", "Value Object", "–•–∏—Ç–±–æ–∫—Å –¥–ª—è –∫–æ–ª–ª–∏–∑–∏–π")
        Component(detector, "CollisionDetector", "Service", "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π")
    }

    Rel(ship, vector2d, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(asteroid, vector2d, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(bullet, vector2d, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(ufo, vector2d, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(detector, collision, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(detector, ship, "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç")
    Rel(detector, asteroid, "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç")
```

#### Application Layer Components

```mermaid
C4Component
    title Application Layer Components

    Container_Boundary(application, "Application Layer") {
        Component(game, "Game", "Facade", "–û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã")
        Component(gameloop, "GameLoop", "Service", "–¶–∏–∫–ª: update() + render()")
        Component(state, "GameState", "State", "–°–æ—Å—Ç–æ—è–Ω–∏–µ: menu/playing/paused/gameover")
        Component(score, "ScoreManager", "Service", "–ü–æ–¥—Å—á—ë—Ç –æ—á–∫–æ–≤, —Ä–µ–∫–æ—Ä–¥—ã")
    }

    Rel(game, gameloop, "–£–ø—Ä–∞–≤–ª—è–µ—Ç")
    Rel(game, state, "–ò–∑–º–µ–Ω—è–µ—Ç")
    Rel(game, score, "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç")
    Rel(gameloop, state, "–ß–∏—Ç–∞–µ—Ç")
```

#### Presentation Layer Components

```mermaid
C4Component
    title Presentation Layer Components

    Container_Boundary(presentation, "Presentation Layer") {
        Component(renderer, "Renderer", "Service", "–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤")
        Component(input, "InputHandler", "Service", "–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã")
        Component(ui_ctrl, "UIController", "Controller", "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤")
    }

    Rel(renderer, input, "–ü–æ–ª—É—á–∞–µ—Ç –≤–≤–æ–¥")
    Rel(ui_ctrl, renderer, "–¢—Ä–∏–≥–≥–µ—Ä–∏—Ç —Ä–µ–Ω–¥–µ—Ä")
```

#### Infrastructure Layer Components

```mermaid
C4Component
    title Infrastructure Layer Components

    Container_Boundary(infrastructure, "Infrastructure Layer") {
        Component(storage, "Storage", "Repository", "–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ localStorage")
        Component(audio, "AudioController", "Service", "–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã")
    }

    Rel(storage, audio, "–ù–µ –∑–∞–≤–∏—Å–∏—Ç")
```

---

### Level 4: Code Level (Key Classes)

#### Domain Entities

```mermaid
classDiagram
    class Vector2D {
        +number x
        +number y
        +add(other: Vector2D): Vector2D
        +subtract(other: Vector2D): Vector2D
        +multiply(scalar: number): Vector2D
        +magnitude(): number
        +normalize(): Vector2D
        +static distance(a: Vector2D, b: Vector2D): number
    }

    class CollisionBox {
        +Vector2D center
        +number radius
        +contains(point: Vector2D): boolean
        +intersects(other: CollisionBox): boolean
    }

    class Ship {
        -Vector2D #position
        -Vector2D #velocity
        -number #rotation
        -number #lives
        -boolean #isThrusting
        +update(deltaTime: number): void
        +rotate(direction: number): void
        +thrust(): void
        +fire(): Bullet
        +getCollisionBox(): CollisionBox
    }

    class Asteroid {
        -Vector2D #position
        -Vector2D #velocity
        -AsteroidSize #size
        +update(deltaTime: number): void
        +split(): Asteroid[]
        +getCollisionBox(): CollisionBox
        +getPoints(): number
    }

    class Bullet {
        -Vector2D #position
        -Vector2D #velocity
        -number #lifetime
        -boolean #isAlive
        +update(deltaTime: number): void
        +getCollisionBox(): CollisionBox
    }

    class UFO {
        -Vector2D #position
        -Vector2D #velocity
        -UFOPattern #pattern
        -number #shootCooldown
        +update(deltaTime: number): void
        +tryFire(): Bullet
        +getCollisionBox(): CollisionBox
    }

    Vector2D --* CollisionBox
    Vector2D --* Ship
    Vector2D --* Asteroid
    Vector2D --* Bullet
    Vector2D --* UFO
    CollisionBox --* Ship
    CollisionBox --* Asteroid
    CollisionBox --* Bullet
    CollisionBox --* UFO
```

#### Application Services

```mermaid
classDiagram
    class GameState {
        +GameStateEnum state
        +number level
        +number score
        +number highScore
        +isPlaying(): boolean
        +isPaused(): boolean
        +isGameOver(): boolean
        +start(): void
        +pause(): void
        +resume(): void
        +gameOver(): void
        +nextLevel(): void
    }

    class GameLoop {
        -number #lastTime
        -number #accumulator
        -number #fixedTimestep
        -Function #updateCallback
        -Function #renderCallback
        +start(): void
        +stop(): void
        +tick(currentTime: number): void
    }

    class ScoreManager {
        -number #currentScore
        -number #highScore
        +addScore(points: number): void
        +getCurrentScore(): number
        +getHighScore(): number
        +saveHighScore(): void
    }

    class Game {
        -GameState #state
        -GameLoop #loop
        -ScoreManager #score
        -Ship #ship
        -Asteroid[] #asteroids
        -Bullet[] #bullets
        -UFO[] #ufos
        +initialize(): void
        +start(): void
        +update(deltaTime: number): void
        +render(): void
        +handleInput(input: Input): void
    }

    GameState --* Game
    GameLoop --* Game
    ScoreManager --* Game
```

---

## üìù Architecture Decision Records (ADRs)

---

### ADR-001: Vanilla JavaScript Without Frameworks

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (React, Vue, Phaser) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è, –Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Vanilla JavaScript (ES2022+)** –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤.

**Consequences:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞ (<100 KB)
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–æ–¥–æ–º
- ‚úÖ –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (—á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- ‚ùå –ë–æ–ª—å—à–µ –∫–æ–¥–∞ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è
- ‚ùå –ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π –¥–ª—èÂ∏∏ËßÅ –∑–∞–¥–∞—á

---

### ADR-002: Clean Architecture with 4 Layers

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Clean Architecture** —Å 4 —Å–ª–æ—è–º–∏:
1. **Domain** ‚Äî —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
2. **Application** ‚Äî –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª, —Å–æ—Å—Ç–æ—è–Ω–∏–µ
3. **Presentation** ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏ –≤–≤–æ–¥
4. **Infrastructure** ‚Äî storage, audio

**Consequences:**
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å (–∫ –¥–æ–º–µ–Ω—É)
- ‚úÖ Domain —Å–ª–æ–π –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–æ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚ùå –ë–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ –∏ –∏–º–ø–æ—Ä—Ç–æ–≤

---

### ADR-003: TDD with Jest and jsdom

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞ —Å–ª–æ–º–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **TDD (Test-Driven Development)** —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º **Jest** –∏ —Å—Ä–µ–¥–æ–π **jsdom**.

**Consequences:**
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >80%
- ‚úÖ –¢–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –î–û –∫–æ–¥–∞ (RED‚ÜíGREEN‚ÜíREFACTOR)
- ‚úÖ jsdom –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å DOM-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ùå –ó–∞–º–µ–¥–ª—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –º–æ–∫–æ–≤ –¥–ª—è Canvas API

---

### ADR-004: Fixed Timestep Game Loop

**Status:** Accepted

**Context:**
–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –¥–æ–ª–∂–µ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ñ–∏–∑–∏–∫—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —á–∞—Å—Ç–æ—Ç—ã –∫–∞–¥—Ä–æ–≤ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π timestep (1/60 —Å–µ–∫)** –¥–ª—è —Ñ–∏–∑–∏–∫–∏ —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ (accumulator pattern).

```javascript
const FIXED_TIMESTEP = 1 / 60; // 16.67ms

update(accumulator) {
    while (accumulator >= FIXED_TIMESTEP) {
        this.physicsUpdate(FIXED_TIMESTEP);
        accumulator -= FIXED_TIMESTEP;
    }
}
```

**Consequences:**
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–∑–∏–∫–∞
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–æ–ª–ª–∏–∑–∏–∏
- ‚úÖ 60 FPS –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–º requestAnimationFrame –Ω–∞–ø—Ä—è–º—É—é

---

### ADR-005: Canvas 2D API for Rendering

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≥—Ä–∞—Ñ–∏–∫–∏. WebGL –º–æ—â–Ω–µ–µ, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ. DOM-—ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–¥–ª–µ–Ω–Ω–µ–µ.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Canvas 2D API** —Å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–∞–º–∏ (–ª–∏–Ω–∏–∏, –ø—É—Ç–∏).

**Consequences:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π API
- ‚úÖ –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è 2D
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å
- ‚ùå –ù–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è –∫–∞–∫ WebGL
- ‚ùå –ù—É–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å –≤—Å—ë –∫–æ–¥–æ–º (–Ω–µ—Ç —Å–ø—Ä–∞–π—Ç–æ–≤)

---

### ADR-006: ES Modules for Code Organization

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ –≤ –º–æ–¥—É–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **ES6 Modules** (`import`/`export`) –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤.

**Consequences:**
- ‚úÖ –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏–º–ø–æ—Ä—Ç–æ–≤
- ‚úÖ Tree-shaking –¥–ª—è —Å–±–æ—Ä—â–∏–∫–æ–≤
- ‚ùå –¢—Ä–µ–±—É–µ—Ç —Å–±–æ—Ä—â–∏–∫ –∏–ª–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä

---

### ADR-007: Object Pooling for Bullets and Asteroids

**Status:** Accepted

**Context:**
–ß–∞—Å—Ç–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç garbage collection –ø–∞—É–∑—ã.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Object Pool pattern** –¥–ª—è –ø—É–ª—å –∏ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤.

```javascript
class BulletPool {
    constructor(size = 50) {
        this.pool = Array(size).fill(null).map(() => new Bullet());
        this.available = new Set(range(size));
    }
    
    acquire() {
        const id = this.available.values().next().value;
        if (id !== undefined) {
            this.available.delete(id);
            return this.pool[id];
        }
        return null; // Pool exhausted
    }
    
    release(bullet) {
        this.available.add(bullet.id);
        bullet.reset();
    }
}
```

**Consequences:**
- ‚úÖ –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è GC –ø–∞—É–∑
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ùå –£—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥
- ‚ùå –ù—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–æ–≤

---

### ADR-008: localStorage for High Scores

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∫–æ—Ä–¥—ã –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏. IndexedDB –º–æ—â–Ω–µ–µ, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **localStorage** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–ø-5 —Ä–µ–∫–æ—Ä–¥–æ–≤.

**Consequences:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π API
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 5 –∑–∞–ø–∏—Å–µ–π
- ‚ùå –õ–∏–º–∏—Ç 5-10 MB (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏

---

### ADR-009: Event-Based Input Handling

**Status:** Accepted

**Context:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–≤–æ–¥ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã. Polling –ø—Ä–æ—â–µ, –Ω–æ event-based —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **event-based –ø–æ–¥—Ö–æ–¥** —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è.

```javascript
class InputHandler {
    constructor() {
        this.keys = new Set();
        window.addEventListener('keydown', (e) => this.keys.add(e.code));
        window.addEventListener('keyup', (e) => this.keys.delete(e.code));
    }
    
    isPressed(code) {
        return this.keys.has(code);
    }
    
    wasJustPressed(code) {
        // Track previous frame state for edge detection
    }
}
```

**Consequences:**
- ‚úÖ –û—Ç–∑—ã–≤—á–∏–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—Ç–∞—á–∞ (–¥–ª—è future touch support)
- ‚ùå –ù—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏

---

### ADR-010: Collision Detection with Circle Approximation

**Status:** Accepted

**Context:**
–¢–æ—á–Ω–∞—è –∫–æ–ª–ª–∏–∑–∏—è –¥–ª—è –º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ —Å–ª–æ–∂–Ω–∞. –ù—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

**Decision:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∫—Ä—É–≥–æ–≤—ã–µ —Ö–∏—Ç–±–æ–∫—Å—ã (CollisionBox)** –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

```javascript
class CollisionBox {
    constructor(center, radius) {
        this.center = center; // Vector2D
        this.radius = radius;
    }
    
    intersects(other) {
        const distance = Vector2D.distance(this.center, other.center);
        return distance < (this.radius + other.radius);
    }
}
```

**Consequences:**
- ‚úÖ O(1) –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ùå –ú–µ–Ω–µ–µ —Ç–æ—á–Ω–æ –¥–ª—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ –∫–æ—Ä–∞–±–ª—è
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞—Ä–∫–∞–¥–Ω–æ–π –∏–≥—Ä—ã

---

## üîí Layer Boundaries

### Dependency Rules

```mermaid
graph TD
    subgraph "Dependency Direction ‚Üí"
        UI[UI Layer] --> PRE[Presentation]
        PRE --> APP[Application]
        APP --> DOM[Domain]
        APP --> INF[Infrastructure]
        INF --> DOM
    end
    
    style DOM fill:#90EE90
    style APP fill:#87CEEB
    style PRE fill:#FFB6C1
    style INF fill:#DDA0DD
    style UI fill:#F0E68C
```

### What Can Cross Boundaries

| From ‚Üí To | Allowed | What Can Cross |
|-----------|---------|----------------|
| **Presentation ‚Üí Domain** | ‚úÖ | –ß–∏—Ç–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏, –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã |
| **Presentation ‚Üí Application** | ‚úÖ | –í—ã–∑—ã–≤–∞—Ç—å Game –º–µ—Ç–æ–¥—ã |
| **Application ‚Üí Domain** | ‚úÖ | –°–æ–∑–¥–∞–≤–∞—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ |
| **Application ‚Üí Infrastructure** | ‚úÖ | –°–æ—Ö—Ä–∞–Ω—è—Ç—å/–∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ |
| **Infrastructure ‚Üí Domain** | ‚úÖ | –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ |
| **Domain ‚Üí Any** | ‚ùå | –ù–∏–∫–∞–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞—Ä—É–∂—É |
| **Infrastructure ‚Üí Presentation** | ‚ùå | –ù–∏–∫–∞–∫–∏—Ö UI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |

### Interface Contracts

#### Domain ‚Üí Application

```javascript
// Domain exports (pure, no dependencies)
export { Ship } from './entities/Ship.js';
export { Asteroid } from './entities/Asteroid.js';
export { Bullet } from './entities/Bullet.js';
export { UFO } from './entities/UFO.js';
export { Vector2D } from './value-objects/Vector2D.js';
export { CollisionBox } from './value-objects/CollisionBox.js';
export { CollisionDetector } from './services/CollisionDetector.js';
```

#### Application ‚Üí Presentation

```javascript
// Application –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Presentation
class Game {
    // Presentation –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç–∏ –º–µ—Ç–æ–¥—ã
    handleInput(input) { }  // InputHandler ‚Üí Game
    getState() { }          // Renderer —á–∏—Ç–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    getScore() { }          // UIController —á–∏—Ç–∞–µ—Ç —Å—á—ë—Ç
}
```

#### Application ‚Üí Infrastructure

```javascript
// Infrastructure —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è Application
class Storage {
    saveHighScore(score) { }
    getHighScore() { }
}

class AudioController {
    playShoot() { }
    playExplosion() { }
}
```

---

## üìä Quality Attributes

| Attribute | Strategy |
|-----------|----------|
| **Performance** | Fixed timestep, object pooling, requestAnimationFrame |
| **Testability** | Dependency injection, pure functions in domain |
| **Maintainability** | Clean Architecture, ES Modules, JSDoc |
| **Extensibility** | Open/Closed principle, component-based design |
| **Reliability** | TDD >80% coverage, error boundaries |

---

## üó∫Ô∏è File Structure

```
src/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Ship.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Asteroid.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Bullet.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UFO.js
‚îÇ   ‚îú‚îÄ‚îÄ value-objects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Vector2D.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CollisionBox.js
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ CollisionDetector.js
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îú‚îÄ‚îÄ Game.js
‚îÇ   ‚îú‚îÄ‚îÄ GameLoop.js
‚îÇ   ‚îú‚îÄ‚îÄ GameState.js
‚îÇ   ‚îî‚îÄ‚îÄ ScoreManager.js
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ Storage.js
‚îÇ   ‚îî‚îÄ‚îÄ AudioController.js
‚îú‚îÄ‚îÄ presentation/
‚îÇ   ‚îú‚îÄ‚îÄ Renderer.js
‚îÇ   ‚îú‚îÄ‚îÄ InputHandler.js
‚îÇ   ‚îî‚îÄ‚îÄ UIController.js
‚îî‚îÄ‚îÄ index.js
```

---

**Architecture Status:** ‚úÖ Accepted  
**Next Phase:** Plan (Implementation Planning)  
**Architect Agent:** Complete


---
## Existing Tests ‚Äî DO NOT MODIFY


### InputHandler.test.js
```
/**
 * Tests for InputHandler
 * 
 * @description –¢–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
 * @module InputHandler
 * @see src/presentation/InputHandler.js
 */

import { jest } from '@jest/globals';

describe('InputHandler', () => {
    let InputHandler;
    let inputHandler;
    let mockWindow;
    let listeners;

    // –ú–æ–∫–∏ –¥–ª—è –∫–ª–∞–≤–∏—à
    const KEYS = {
        ARROW_UP: 'ArrowUp',
        ARROW_DOWN: 'ArrowDown',
        ARROW_LEFT: 'ArrowLeft',
        ARROW_RIGHT: 'ArrowRight',
        KEY_W: 'KeyW',
        KEY_A: 'KeyA',
        KEY_S: 'KeyS',
        KEY_D: 'KeyD',
        SPACE: 'Space',
        KEY_P: 'KeyP',
        KEY_H: 'KeyH',
        KEY_R: 'KeyR'
    };

    beforeEach(async () => {
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
        InputHandler = (await import('../../src/presentation/InputHandler.js')).InputHandler;

        // –°–æ–∑–¥–∞—ë–º –º–æ–∫ window —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º event listeners
        listeners = { keydown: [], keyup: [] };
        mockWindow = {
            addEventListener: jest.fn((event, handler) => {
                if (event === 'keydown' || event === 'keyup') {
                    listeners[event].push(handler);
                }
            }),
            removeEventListener: jest.fn()
        };

        inputHandler = new InputHandler(mockWindow);
    });

    afterEach(() => {
        jest.clearAllMocks();
    });

    describe('constructor', () => {
        test('should register keydown event listener', () => {
            expect(mockWindow.addEventListener).toHaveBeenCalledWith(
                'keydown',
                expect.any(Function)
            );
        });

        test('should register keyup event listener', () => {
            expect(mockWindow.addEventListener).toHaveBeenCalledWith(
                'keyup',
                expect.any(Function)
            );
        });

        test('should use default window if not provided', async () => {
            const DefaultInputHandler = (await import('../../src/presentation/InputHandler.js')).InputHandler;
            // –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è window –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const handler = new DefaultInputHandler();
            expect(handler).toBeDefined();
        });
    });

    describe('isPressed', () => {
        test('should return true for pressed key', () => {
            const event = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            expect(inputHandler.isPressed(KEYS.ARROW_UP)).toBe(true);
        });

        test('should return false for released key', () => {
            // –ù–∞–∂–∏–º–∞–µ–º –∫–ª–∞–≤–∏—à—É
            const keydownEvent = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(keydownEvent));

            // –û—Ç–ø—É—Å–∫–∞–µ–º –∫–ª–∞–≤–∏—à—É
            const keyupEvent = { code: KEYS.ARROW_UP };
            listeners.keyup.forEach(fn => fn(keyupEvent));

            expect(inputHandler.isPressed(KEYS.ARROW_UP)).toBe(false);
        });

        test('should return false for unpressed key', () => {
            expect(inputHandler.isPressed(KEYS.ARROW_UP)).toBe(false);
        });

        test('should track multiple keys simultaneously', () => {
            const event1 = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            const event2 = { code: KEYS.SPACE, preventDefault: jest.fn() };

            listeners.keydown.forEach(fn => fn(event1));
            listeners.keydown.forEach(fn => fn(event2));

            expect(inputHandler.isPressed(KEYS.ARROW_UP)).toBe(true);
            expect(inputHandler.isPressed(KEYS.SPACE)).toBe(true);
        });

        test('should call preventDefault on keydown events', () => {
            const preventDefault = jest.fn();
            const event = { code: KEYS.ARROW_UP, preventDefault };

            listeners.keydown.forEach(fn => fn(event));

            expect(preventDefault).toHaveBeenCalled();
        });
    });

    describe('wasJustPressed (edge detection)', () => {
        test('should return true when key was just pressed in current frame', () => {
            const event = { code: KEYS.SPACE, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(true);
        });

        test('should return false when key was held from previous frame', () => {
            const event = { code: KEYS.SPACE, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            // –ó–∞–≤–µ—Ä—à–∞–µ–º –∫–∞–¥—Ä ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–º
            inputHandler.endFrame();

            // –ö–ª–∞–≤–∏—à–∞ –≤—Å—ë –µ—â—ë –Ω–∞–∂–∞—Ç–∞, –Ω–æ –Ω–µ "—Ç–æ–ª—å–∫–æ —á—Ç–æ"
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(false);
        });

        test('should return false for unpressed key', () => {
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(false);
        });

        test('should detect new key press after endFrame', () => {
            // –°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–∏–º–∞–µ–º –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –∫–∞–¥—Ä
            const event1 = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event1));
            inputHandler.endFrame();

            // –û—Ç–ø—É—Å–∫–∞–µ–º —Å—Ç–∞—Ä—É—é –∫–ª–∞–≤–∏—à—É –∏ –Ω–∞–∂–∏–º–∞–µ–º –Ω–æ–≤—É—é
            const keyupEvent = { code: KEYS.ARROW_UP };
            listeners.keyup.forEach(fn => fn(keyupEvent));

            const event2 = { code: KEYS.SPACE, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event2));

            expect(inputHandler.wasJustPressed(KEYS.ARROW_UP)).toBe(false);
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(true);
        });
    });

    describe('endFrame', () => {
        test('should save current key state as previous state', () => {
            const event = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            inputHandler.endFrame();

            // –ü–æ—Å–ª–µ endFrame wasJustPressed –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å false
            expect(inputHandler.wasJustPressed(KEYS.ARROW_UP)).toBe(false);
        });

        test('should allow detection of new key presses in next frame', () => {
            inputHandler.endFrame();

            const event = { code: KEYS.SPACE, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(true);
        });
    });

    describe('getState', () => {
        test('should return input state object with all actions', () => {
            const state = inputHandler.getState();

            expect(state).toHaveProperty('thrust');
            expect(state).toHaveProperty('rotateLeft');
            expect(state).toHaveProperty('rotateRight');
            expect(state).toHaveProperty('fire');
            expect(state).toHaveProperty('hyperspace');
            expect(state).toHaveProperty('pause');
        });

        test('should map ArrowUp and KeyW to thrust', () => {
            const eventUp = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            const eventW = { code: KEYS.KEY_W, preventDefault: jest.fn() };

            listeners.keydown.forEach(fn => fn(eventUp));
            let state = inputHandler.getState();
            expect(state.thrust).toBe(true);

            listeners.keyup.forEach(fn => fn({ code: KEYS.ARROW_UP }));
            listeners.keydown.forEach(fn => fn(eventW));
            state = inputHandler.getState();
            expect(state.thrust).toBe(true);
        });

        test('should map ArrowLeft and KeyA to rotateLeft', () => {
            const eventLeft = { code: KEYS.ARROW_LEFT, preventDefault: jest.fn() };
            const eventA = { code: KEYS.KEY_A, preventDefault: jest.fn() };

            listeners.keydown.forEach(fn => fn(eventLeft));
            let state = inputHandler.getState();
            expect(state.rotateLeft).toBe(true);

            listeners.keyup.forEach(fn => fn({ code: KEYS.ARROW_LEFT }));
            listeners.keydown.forEach(fn => fn(eventA));
            state = inputHandler.getState();
            expect(state.rotateLeft).toBe(true);
        });

        test('should map ArrowRight and KeyD to rotateRight', () => {
            const eventRight = { code: KEYS.ARROW_RIGHT, preventDefault: jest.fn() };
            const eventD = { code: KEYS.KEY_D, preventDefault: jest.fn() };

            listeners.keydown.forEach(fn => fn(eventRight));
            let state = inputHandler.getState();
            expect(state.rotateRight).toBe(true);

            listeners.keyup.forEach(fn => fn({ code: KEYS.ARROW_RIGHT }));
            listeners.keydown.forEach(fn => fn(eventD));
            state = inputHandler.getState();
            expect(state.rotateRight).toBe(true);
        });

        test('should map Space to fire', () => {
            const event = { code: KEYS.SPACE, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            const state = inputHandler.getState();
            expect(state.fire).toBe(true);
        });

        test('should map KeyH to hyperspace', () => {
            const event = { code: KEYS.KEY_H, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            const state = inputHandler.getState();
            expect(state.hyperspace).toBe(true);
        });

        test('should map KeyP to pause', () => {
            const event = { code: KEYS.KEY_P, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            const state = inputHandler.getState();
            expect(state.pause).toBe(true);
        });

        test('should return all false when no keys pressed', () => {
            const state = inputHandler.getState();

            expect(state.thrust).toBe(false);
            expect(state.rotateLeft).toBe(false);
            expect(state.rotateRight).toBe(false);
            expect(state.fire).toBe(false);
            expect(state.hyperspace).toBe(false);
            expect(state.pause).toBe(false);
        });

        test('should handle multiple simultaneous inputs', () => {
            const thrustEvent = { code: KEYS.ARROW_UP, preventDefault: jest.fn() };
            const fireEvent = { code: KEYS.SPACE, preventDefault: jest.fn() };

            listeners.keydown.forEach(fn => fn(thrustEvent));
            listeners.keydown.forEach(fn => fn(fireEvent));

            const state = inputHandler.getState();
            expect(state.thrust).toBe(true);
            expect(state.fire).toBe(true);
        });
    });

    describe('key mappings', () => {
        const keyMappings = [
            { code: KEYS.ARROW_UP, action: 'thrust', description: 'ArrowUp ‚Üí thrust' },
            { code: KEYS.KEY_W, action: 'thrust', description: 'KeyW ‚Üí thrust' },
            { code: KEYS.ARROW_LEFT, action: 'rotateLeft', description: 'ArrowLeft ‚Üí rotateLeft' },
            { code: KEYS.KEY_A, action: 'rotateLeft', description: 'KeyA ‚Üí rotateLeft' },
            { code: KEYS.ARROW_RIGHT, action: 'rotateRight', description: 'ArrowRight ‚Üí rotateRight' },
            { code: KEYS.KEY_D, action: 'rotateRight', description: 'KeyD ‚Üí rotateRight' },
            { code: KEYS.SPACE, action: 'fire', description: 'Space ‚Üí fire' },
            { code: KEYS.KEY_H, action: 'hyperspace', description: 'KeyH ‚Üí hyperspace' },
            { code: KEYS.KEY_P, action: 'pause', description: 'KeyP ‚Üí pause' }
        ];

        test.each(keyMappings)('$description', ({ code, action }) => {
            const event = { code, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(event));

            const state = inputHandler.getState();
            expect(state[action]).toBe(true);
        });
    });

    describe('input state transitions', () => {
        test('should correctly track key press and release cycle', () => {
            // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            expect(inputHandler.isPressed(KEYS.SPACE)).toBe(false);
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(false);

            // –ù–∞–∂–∞—Ç–∏–µ
            const keydownEvent = { code: KEYS.SPACE, preventDefault: jest.fn() };
            listeners.keydown.forEach(fn => fn(keydownEvent));

            expect(inputHandler.isPressed(KEYS.SPACE)).toBe(true);
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(true);

            // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–∞–¥—Ä–∞
            inputHandler.endFrame();

            expect(inputHandler.isPressed(KEYS.SPACE)).toBe(true);
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(false);

            // –û—Ç–ø—É—Å–∫–∞–Ω–∏–µ
            const keyupEvent = { code: KEYS.SPACE };
            listeners.keyup.forEach(fn => fn(keyupEvent));

            expect(inputHandler.isPressed(KEYS.SPACE)).toBe(false);
            expect(inputHandler.wasJustPressed(KEYS.SPACE)).toBe(false);
        });
    });
});

```


### output.md
```
<!-- DRY-RUN: no LLM response. Paste the prompt from clipboard into your LLM and save the result manually. -->
```


### README.md
```
# Phase 4 Tests ‚Äî Presentation Layer

**Phase:** 4  
**Layer:** Presentation  
**Status:** Ready for Approval  
**Created:** 2026-02-26

---

## Overview

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç **Presentation Layer** –∏–≥—Ä—ã Asteroids ‚Äî —Å–ª–æ–π, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞:
- –û–±—Ä–∞–±–æ—Ç–∫—É –≤–≤–æ–¥–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–∏ —á–µ—Ä–µ–∑ Canvas 2D API
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (HUD, –º–µ–Ω—é, —ç–∫—Ä–∞–Ω—ã –ø–∞—É–∑—ã/Game Over)

---

## Test Files

### 1. InputHandler.test.js

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/presentation/InputHandler.js`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è event listeners (keydown/keyup)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞–≤–∏—à (`isPressed`)
- Edge detection –¥–ª—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (`wasJustPressed`)
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–∞–¥—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`endFrame`)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–≤–æ–¥–∞ (`getState`)
- –ú–∞–ø–ø–∏–Ω–≥ –∫–ª–∞–≤–∏—à –Ω–∞ –∏–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

**–ö–ª–∞–≤–∏—à–∏:**
| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| ArrowUp / W | Thrust (—Ç—è–≥–∞) |
| ArrowLeft / A | Rotate Left (–≤—Ä–∞—â–µ–Ω–∏–µ –≤–ª–µ–≤–æ) |
| ArrowRight / D | Rotate Right (–≤—Ä–∞—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ) |
| Space | Fire (–æ–≥–æ–Ω—å) |
| H | Hyperspace (–≥–∏–ø–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ) |
| P | Pause (–ø–∞—É–∑–∞) |

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 25+

---

### 2. Renderer.test.js

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/presentation/Renderer.js`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –û—á–∏—Å—Ç–∫–∞ canvas —á—ë—Ä–Ω—ã–º —Ñ–æ–Ω–æ–º
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ (–±–µ–ª—ã–µ –ª–∏–Ω–∏–∏, —Ç–æ–ª—â–∏–Ω–∞ 2px)
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª—è (—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏)
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤ (–º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫–∏)
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—É–ª—å (–ª–∏–Ω–∏–∏)
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ù–õ–û (—ç–ª–ª–∏–ø—Å—ã)
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∑—Ä—ã–≤–æ–≤ (—Ä–∞—Å—Ö–æ–¥—è—â–∏–µ—Å—è –ª–∏–Ω–∏–∏)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (translate, rotate)

**–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã:**
| –°—É—â–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–∏—Ç–∏–≤—ã |
|----------|-----------|
| Ship | 3 –ª–∏–Ω–∏–∏ (—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫) |
| Asteroid | 6-8 –ª–∏–Ω–∏–π (–º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫) |
| Bullet | 1 –ª–∏–Ω–∏—è |
| UFO | 2 —ç–ª–ª–∏–ø—Å–∞ + –ª–∏–Ω–∏–∏ |
| Explosion | 12 —Ä–∞—Å—Ö–æ–¥—è—â–∏—Ö—Å—è –ª–∏–Ω–∏–π |

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 40+

---

### 3. UIController.test.js

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/presentation/UIController.js`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HUD —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (score, lives, level, highScore)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é —ç–∫—Ä–∞–Ω–æ–≤ (menu, pause, gameOver)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ (start, restart)
- –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ UI

**DOM —ç–ª–µ–º–µ–Ω—Ç—ã:**
| ID | –≠–ª–µ–º–µ–Ω—Ç |
|----|---------|
| score | –¢–µ–∫—É—â–∏–π —Å—á—ë—Ç |
| lives | –ñ–∏–∑–Ω–∏ |
| level | –£—Ä–æ–≤–µ–Ω—å |
| high-score | –†–µ–∫–æ—Ä–¥ |
| menu | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| pause | –≠–∫—Ä–∞–Ω –ø–∞—É–∑—ã |
| game-over | –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã |
| start-button | –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞ |
| restart-button | –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ |

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 40+

---

## Mock Objects

### canvas.js

–°–æ–∑–¥–∞—ë—Ç –º–æ–∫ –¥–ª—è Canvas API:
- `createMockCanvas(width, height)` ‚Äî –º–æ–∫ HTMLCanvasElement
- `createMockCanvasContext()` ‚Äî –º–æ–∫ CanvasRenderingContext2D
- `createMockOffscreenCanvas(width, height)` ‚Äî –º–æ–∫ OffscreenCanvas

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```javascript
import { createMockCanvas } from '../__mocks__/canvas.js';

const canvas = createMockCanvas(800, 600);
const ctx = canvas._getMockContext();
```

---

## Running Tests

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ Phase 4
```bash
npm test -- src/tests/phase_4/
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```bash
npm run test:coverage -- src/tests/phase_4/
```

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ watch
```bash
npm run test:watch -- src/tests/phase_4/
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```bash
# InputHandler
npm test -- src/tests/phase_4/InputHandler.test.js

# Renderer
npm test -- src/tests/phase_4/Renderer.test.js

# UIController
npm test -- src/tests/phase_4/UIController.test.js
```

---

## Expected Results (RED Phase)

**–î–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã **FAIL**:

```
FAIL src/tests/phase_4/InputHandler.test.js
  ‚óè InputHandler ‚Ä∫ constructor ‚Ä∫ should register keydown event listener
    Cannot find module '../../src/presentation/InputHandler.js'

FAIL src/tests/phase_4/Renderer.test.js
  ‚óè Renderer ‚Ä∫ constructor ‚Ä∫ should store canvas reference
    Cannot find module '../../src/presentation/Renderer.js'

FAIL src/tests/phase_4/UIController.test.js
  ‚óè UIController ‚Ä∫ constructor ‚Ä∫ should store document reference
    Cannot find module '../../src/presentation/UIController.js'
```

–≠—Ç–æ **–æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –≤ TDD –ø—Ä–æ—Ü–µ—Å—Å–µ (RED phase).

---

## Coverage Goals

| Component | Goal |
|-----------|------|
| InputHandler | >80% |
| Renderer | >80% |
| UIController | >80% |

---

## What Is Covered

### InputHandler
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è event listeners
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞–≤–∏—à
- ‚úÖ Edge detection (wasJustPressed)
- ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –∫–ª–∞–≤–∏—à –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –ú—É–ª—å—Ç–∏—Ç–∞—á (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∞–≤–∏—à)
- ‚úÖ PreventDefault –¥–ª—è keydown —Å–æ–±—ã—Ç–∏–π

### Renderer
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ canvas
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
- ‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª—è —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏
- ‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤ (–º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫–∏)
- ‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—É–ª—å
- ‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ù–õ–û
- ‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∑—Ä—ã–≤–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

### UIController
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HUD —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
- ‚úÖ –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–∞—É–∑—ã
- ‚úÖ –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ Game Over —ç–∫—Ä–∞–Ω–∞
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ start/restart
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ UI

---

## What Is NOT Covered

### InputHandler
- ‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º DOM (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–∏)
- ‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ touch —Å–æ–±—ã—Ç–∏–π (–¥–ª—è future mobile support)
- ‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ gamepad API

### Renderer
- ‚ùå –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∏ (—Ç–æ–ª—å–∫–æ –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤)
- ‚ùå –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ (FPS, batch rendering)
- ‚ùå –ê–Ω–∏–º–∞—Ü–∏—è —Ç—è–≥–∏ –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ø—É–ª—å—Å–∞—Ü–∏—è)
- ‚ùå –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –∏ –∞–Ω—Ç–∏–∞–ª–∏–∞—Å–∏–Ω–≥

### UIController
- ‚ùå –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è CSS (—Ç–æ–ª—å–∫–æ display property)
- ‚ùå –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
- ‚ùå –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã UI

---

## Implementation Requirements

–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

### InputHandler
```javascript
export class InputHandler {
    constructor(windowObj = window) {
        this.keys = new Set();
        this.previousKeys = new Set();
        // ... —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è event listeners
    }

    isPressed(code) { /* ... */ }
    wasJustPressed(code) { /* ... */ }
    endFrame() { /* ... */ }
    getState() { /* ... */ }
}
```

### Renderer
```javascript
export class Renderer {
    constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.width = canvas.width;
        this.height = canvas.height;
    }

    render(gameState) { /* ... */ }
    drawShip(ship) { /* ... */ }
    drawAsteroid(asteroid) { /* ... */ }
    drawBullet(bullet) { /* ... */ }
    drawUFO(ufo) { /* ... */ }
    drawExplosion(position) { /* ... */ }
}
```

### UIController
```javascript
export class UIController {
    constructor(documentObj = document) {
        // ... –ø–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ ID
    }

    updateScore(score) { /* ... */ }
    updateLives(lives) { /* ... */ }
    updateLevel(level) { /* ... */ }
    updateHighScore(score) { /* ... */ }
    showMenu() { /* ... */ }
    hideMenu() { /* ... */ }
    showPause() { /* ... */ }
    hidePause() { /* ... */ }
    showGameOver(score) { /* ... */ }
    hideGameOver() { /* ... */ }
    showLevelComplete(level) { /* ... */ }
    on(event, callback) { /* ... */ }
}
```

---

## TDD Workflow

1. **RED** ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ FAIL
2. **GREEN** ‚Äî –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
3. **REFACTOR** ‚Äî –£–ª—É—á—à–∏—Ç—å –∫–æ–¥, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

---

## Approval Status

- [x] Tests written
- [ ] Tests approved by human
- [ ] Tests locked (immutable)
- [ ] Implementation started
- [ ] Implementation complete (GREEN phase)
- [ ] Code reviewed

---

**Tests Ready for Approval**  
**Files:** InputHandler.test.js, Renderer.test.js, UIController.test.js  
**Coverage Intention:** –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è  
**Awaiting human approval before implementation begins.**

```


### Renderer.test.js
```
/**
 * Tests for Renderer
 * 
 * @description –¢–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Canvas 2D API
 * @module Renderer
 * @see src/presentation/Renderer.js
 */

import { jest } from '@jest/globals';
import { createMockCanvas } from '../__mocks__/canvas.js';

describe('Renderer', () => {
    let Renderer;
    let renderer;
    let canvas;
    let ctx;

    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    const CANVAS_WIDTH = 800;
    const CANVAS_HEIGHT = 600;
    const BLACK = '#000000';
    const WHITE = '#FFFFFF';

    beforeEach(async () => {
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
        Renderer = (await import('../../src/presentation/Renderer.js')).Renderer;

        // –°–æ–∑–¥–∞—ë–º –º–æ–∫ canvas
        canvas = createMockCanvas(CANVAS_WIDTH, CANVAS_HEIGHT);
        ctx = canvas._getMockContext();

        renderer = new Renderer(canvas);
    });

    afterEach(() => {
        jest.clearAllMocks();
    });

    describe('constructor', () => {
        test('should store canvas reference', () => {
            expect(renderer.canvas).toBe(canvas);
        });

        test('should get 2d context from canvas', () => {
            expect(canvas.getContext).toHaveBeenCalledWith('2d');
        });

        test('should store context reference', () => {
            expect(renderer.ctx).toBe(ctx);
        });

        test('should store canvas width', () => {
            expect(renderer.width).toBe(CANVAS_WIDTH);
        });

        test('should store canvas height', () => {
            expect(renderer.height).toBe(CANVAS_HEIGHT);
        });
    });

    describe('render', () => {
        test('should clear canvas with black background', () => {
            renderer.render({ ship: null, asteroids: [], bullets: [], ufos: [] });

            expect(ctx.fillStyle).toBe(BLACK);
            expect(ctx.fillRect).toHaveBeenCalledWith(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        });

        test('should set white stroke style', () => {
            renderer.render({ ship: null, asteroids: [], bullets: [], ufos: [] });

            expect(ctx.strokeStyle).toBe(WHITE);
            expect(ctx.lineWidth).toBe(2);
        });

        test('should clear canvas before drawing', () => {
            renderer.render({ ship: null, asteroids: [], bullets: [], ufos: [] });

            expect(ctx.clearRect).toHaveBeenCalled();
        });

        test('should render empty game state without errors', () => {
            expect(() => {
                renderer.render({ ship: null, asteroids: [], bullets: [], ufos: [] });
            }).not.toThrow();
        });
    });

    describe('drawShip', () => {
        test('should save context state before drawing', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.save).toHaveBeenCalled();
        });

        test('should restore context state after drawing', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.restore).toHaveBeenCalled();
        });

        test('should translate to ship position', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.translate).toHaveBeenCalledWith(400, 300);
        });

        test('should rotate by ship rotation angle', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: Math.PI / 4,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.rotate).toHaveBeenCalledWith(Math.PI / 4);
        });

        test('should begin path for triangle', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.beginPath).toHaveBeenCalled();
        });

        test('should draw triangle from vertices', () => {
            const vertices = [
                { x: 0, y: -20 },
                { x: -15, y: 20 },
                { x: 15, y: 20 }
            ];
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => vertices)
            };

            renderer.drawShip(mockShip);

            expect(ctx.moveTo).toHaveBeenCalledWith(vertices[0].x, vertices[0].y);
            expect(ctx.lineTo).toHaveBeenCalledWith(vertices[1].x, vertices[1].y);
            expect(ctx.lineTo).toHaveBeenCalledWith(vertices[2].x, vertices[2].y);
        });

        test('should close path after drawing triangle', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.closePath).toHaveBeenCalled();
        });

        test('should stroke the triangle', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            expect(ctx.stroke).toHaveBeenCalled();
        });

        test('should draw thrust flame when ship is thrusting', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                isThrusting: true,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            // Thrust –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω (–ø—Ä–æ–≤–µ—Ä—è–µ–º fill –¥–ª—è –ø–ª–∞–º–µ–Ω–∏)
            expect(ctx.fill).toHaveBeenCalled();
        });

        test('should not draw thrust flame when ship is not thrusting', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                isThrusting: false,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            renderer.drawShip(mockShip);

            // –î–ª—è –∫–æ—Ä–∞–±–ª—è –±–µ–∑ —Ç—è–≥–∏ fill –Ω–µ –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è (—Ç–æ–ª—å–∫–æ stroke)
            // –ù–æ stroke –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞, —Ç–∞–∫ —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
            const fillCalls = ctx.fill.mock.calls.length;
            expect(fillCalls).toBeLessThan(2); // –¢–æ–ª—å–∫–æ –¥–ª—è thrust, –µ—Å–ª–∏ –µ—Å—Ç—å
        });
    });

    describe('drawAsteroid', () => {
        test('should save context state before drawing', () => {
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.save).toHaveBeenCalled();
        });

        test('should restore context state after drawing', () => {
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.restore).toHaveBeenCalled();
        });

        test('should translate to asteroid position', () => {
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.translate).toHaveBeenCalledWith(100, 100);
        });

        test('should begin path for polygon', () => {
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.beginPath).toHaveBeenCalled();
        });

        test('should draw polygon from vertices', () => {
            const vertices = [
                { x: 0, y: -30 },
                { x: 20, y: -20 },
                { x: 25, y: 10 },
                { x: 0, y: 30 },
                { x: -25, y: 10 },
                { x: -20, y: -20 }
            ];
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => vertices)
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.moveTo).toHaveBeenCalledWith(vertices[0].x, vertices[0].y);
            expect(ctx.lineTo).toHaveBeenCalledWith(vertices[1].x, vertices[1].y);
            expect(ctx.lineTo).toHaveBeenCalledWith(vertices[2].x, vertices[2].y);
        });

        test('should close path after drawing polygon', () => {
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.closePath).toHaveBeenCalled();
        });

        test('should stroke the polygon', () => {
            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            renderer.drawAsteroid(mockAsteroid);

            expect(ctx.stroke).toHaveBeenCalled();
        });
    });

    describe('drawBullet', () => {
        test('should begin path for bullet line', () => {
            const mockBullet = {
                position: { x: 200, y: 200 },
                direction: { x: 0, y: -1 }
            };

            renderer.drawBullet(mockBullet);

            expect(ctx.beginPath).toHaveBeenCalled();
        });

        test('should draw line from bullet position in direction', () => {
            const mockBullet = {
                position: { x: 200, y: 200 },
                direction: { x: 0, y: -1 }
            };

            renderer.drawBullet(mockBullet);

            expect(ctx.moveTo).toHaveBeenCalledWith(200, 200);
            expect(ctx.lineTo).toHaveBeenCalledWith(200, 210); // direction * 10
        });

        test('should stroke the bullet line', () => {
            const mockBullet = {
                position: { x: 200, y: 200 },
                direction: { x: 0, y: -1 }
            };

            renderer.drawBullet(mockBullet);

            expect(ctx.stroke).toHaveBeenCalled();
        });

        test('should draw bullet in different directions', () => {
            const mockBullet = {
                position: { x: 400, y: 300 },
                direction: { x: 1, y: 0 }
            };

            renderer.drawBullet(mockBullet);

            expect(ctx.moveTo).toHaveBeenCalledWith(400, 300);
            expect(ctx.lineTo).toHaveBeenCalledWith(390, 300); // -direction.x * 10
        });
    });

    describe('drawUFO', () => {
        test('should save context state before drawing', () => {
            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.drawUFO(mockUFO);

            expect(ctx.save).toHaveBeenCalled();
        });

        test('should restore context state after drawing', () => {
            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.drawUFO(mockUFO);

            expect(ctx.restore).toHaveBeenCalled();
        });

        test('should translate to UFO position', () => {
            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.drawUFO(mockUFO);

            expect(ctx.translate).toHaveBeenCalledWith(300, 100);
        });

        test('should draw dome with arc', () => {
            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.drawUFO(mockUFO);

            expect(ctx.arc).toHaveBeenCalled();
        });

        test('should draw base with ellipse', () => {
            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.drawUFO(mockUFO);

            expect(ctx.ellipse).toHaveBeenCalled();
        });

        test('should stroke the UFO', () => {
            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.drawUFO(mockUFO);

            expect(ctx.stroke).toHaveBeenCalled();
        });
    });

    describe('drawExplosion', () => {
        test('should save context state before drawing', () => {
            renderer.drawExplosion({ x: 400, y: 300 });

            expect(ctx.save).toHaveBeenCalled();
        });

        test('should restore context state after drawing', () => {
            renderer.drawExplosion({ x: 400, y: 300 });

            expect(ctx.restore).toHaveBeenCalled();
        });

        test('should translate to explosion position', () => {
            renderer.drawExplosion({ x: 400, y: 300 });

            expect(ctx.translate).toHaveBeenCalledWith(400, 300);
        });

        test('should begin path for explosion lines', () => {
            renderer.drawExplosion({ x: 400, y: 300 });

            expect(ctx.beginPath).toHaveBeenCalled();
        });

        test('should stroke explosion lines', () => {
            renderer.drawExplosion({ x: 400, y: 300 });

            expect(ctx.stroke).toHaveBeenCalled();
        });

        test('should draw multiple explosion lines', () => {
            renderer.drawExplosion({ x: 400, y: 300 });

            // beginPath –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–¥–ª—è –∫–∞–∂–¥–æ–π –ª–∏–Ω–∏–∏)
            expect(ctx.beginPath).toHaveBeenCalledTimes(12);
        });
    });

    describe('full render cycle', () => {
        test('should render complete game state', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                isThrusting: false,
                getVertices: jest.fn(() => [
                    { x: 0, y: -20 },
                    { x: -15, y: 20 },
                    { x: 15, y: 20 }
                ])
            };

            const mockAsteroid = {
                position: { x: 100, y: 100 },
                getVertices: jest.fn(() => [
                    { x: 0, y: -30 },
                    { x: 20, y: -20 },
                    { x: 25, y: 10 },
                    { x: 0, y: 30 },
                    { x: -25, y: 10 },
                    { x: -20, y: -20 }
                ])
            };

            const mockBullet = {
                position: { x: 200, y: 200 },
                direction: { x: 0, y: -1 }
            };

            const mockUFO = {
                position: { x: 300, y: 100 }
            };

            renderer.render({
                ship: mockShip,
                asteroids: [mockAsteroid],
                bullets: [mockBullet],
                ufos: [mockUFO]
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –±—ã–ª–∏ –≤—ã–∑–≤–∞–Ω—ã
            expect(ctx.save).toHaveBeenCalled();
            expect(ctx.restore).toHaveBeenCalled();
            expect(ctx.stroke).toHaveBeenCalled();
        });

        test('should render multiple asteroids', () => {
            const mockAsteroids = [
                {
                    position: { x: 100, y: 100 },
                    getVertices: jest.fn(() => [{ x: 0, y: -30 }, { x: 30, y: 0 }, { x: 0, y: 30 }, { x: -30, y: 0 }])
                },
                {
                    position: { x: 200, y: 200 },
                    getVertices: jest.fn(() => [{ x: 0, y: -30 }, { x: 30, y: 0 }, { x: 0, y: 30 }, { x: -30, y: 0 }])
                },
                {
                    position: { x: 300, y: 300 },
                    getVertices: jest.fn(() => [{ x: 0, y: -30 }, { x: 30, y: 0 }, { x: 0, y: 30 }, { x: -30, y: 0 }])
                }
            ];

            renderer.render({
                ship: null,
                asteroids: mockAsteroids,
                bullets: [],
                ufos: []
            });

            // translate –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Å—Ç–µ—Ä–æ–∏–¥–∞
            expect(ctx.translate).toHaveBeenCalledTimes(3);
        });

        test('should render multiple bullets', () => {
            const mockBullets = [
                { position: { x: 100, y: 100 }, direction: { x: 0, y: -1 } },
                { position: { x: 200, y: 200 }, direction: { x: 1, y: 0 } },
                { position: { x: 300, y: 300 }, direction: { x: 0, y: 1 } }
            ];

            renderer.render({
                ship: null,
                asteroids: [],
                bullets: mockBullets,
                ufos: []
            });

            // moveTo –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –ø—É–ª–∏
            expect(ctx.moveTo).toHaveBeenCalledTimes(3);
        });
    });

    describe('rendering order', () => {
        test('should clear canvas before drawing entities', () => {
            const mockShip = {
                position: { x: 400, y: 300 },
                rotation: 0,
                getVertices: jest.fn(() => [{ x: 0, y: -20 }, { x: -15, y: 20 }, { x: 15, y: 20 }])
            };

            renderer.render({
                ship: mockShip,
                asteroids: [],
                bullets: [],
                ufos: []
            });

            // fillRect (–æ—á–∏—Å—Ç–∫–∞) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –¥–æ save (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª—è)
            const fillRectCall = ctx.fillRect.mock.invocationCallOrder[0];
            const saveCall = ctx.save.mock.invocationCallOrder[0];
            
            expect(fillRectCall).toBeLessThan(saveCall);
        });
    });
});

```


### UIController.test.js
```
/**
 * Tests for UIController
 * 
 * @description –¢–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (HUD, –º–µ–Ω—é, —ç–∫—Ä–∞–Ω—ã)
 * @module UIController
 * @see src/presentation/UIController.js
 */

import { jest } from '@jest/globals';

describe('UIController', () => {
    let UIController;
    let uiController;
    let mockDocument;
    let mockElements;

    beforeEach(async () => {
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
        UIController = (await import('../../src/presentation/UIController.js')).UIController;

        // –°–æ–∑–¥–∞—ë–º –º–æ–∫ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        mockElements = {
            scoreEl: { textContent: '' },
            livesEl: { textContent: '' },
            levelEl: { textContent: '' },
            highScoreEl: { textContent: '' },
            menuEl: {
                style: { display: 'block' },
                classList: {
                    add: jest.fn(),
                    remove: jest.fn()
                },
                querySelector: jest.fn(() => null),
                appendChild: jest.fn(),
                removeChild: jest.fn()
            },
            pauseEl: {
                style: { display: 'none' },
                classList: {
                    add: jest.fn(),
                    remove: jest.fn()
                }
            },
            gameOverEl: {
                style: { display: 'none' },
                classList: {
                    add: jest.fn(),
                    remove: jest.fn()
                },
                querySelector: jest.fn(() => ({ textContent: '' }))
            },
            startButton: {
                addEventListener: jest.fn()
            },
            restartButton: {
                addEventListener: jest.fn()
            }
        };

        // –°–æ–∑–¥–∞—ë–º –º–æ–∫ document
        mockDocument = {
            getElementById: jest.fn((id) => {
                const map = {
                    'score': mockElements.scoreEl,
                    'lives': mockElements.livesEl,
                    'level': mockElements.levelEl,
                    'high-score': mockElements.highScoreEl,
                    'menu': mockElements.menuEl,
                    'pause': mockElements.pauseEl,
                    'game-over': mockElements.gameOverEl,
                    'start-button': mockElements.startButton,
                    'restart-button': mockElements.restartButton
                };
                return map[id] || null;
            }),
            createElement: jest.fn(() => ({
                className: '',
                textContent: '',
                style: { display: 'none' }
            })),
            addEventListener: jest.fn()
        };

        uiController = new UIController(mockDocument);
    });

    afterEach(() => {
        jest.clearAllMocks();
    });

    describe('constructor', () => {
        test('should store document reference', () => {
            expect(uiController.document).toBe(mockDocument);
        });

        test('should get score element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('score');
        });

        test('should get lives element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('lives');
        });

        test('should get level element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('level');
        });

        test('should get high score element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('high-score');
        });

        test('should get menu element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('menu');
        });

        test('should get pause element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('pause');
        });

        test('should get game over element by id', () => {
            expect(mockDocument.getElementById).toHaveBeenCalledWith('game-over');
        });

        test('should use default document if not provided', async () => {
            const DefaultUIController = (await import('../../src/presentation/UIController.js')).UIController;
            const controller = new DefaultUIController();
            expect(controller).toBeDefined();
        });
    });

    describe('updateScore', () => {
        test('should update score display', () => {
            uiController.updateScore(1500);
            expect(mockElements.scoreEl.textContent).toBe('1500');
        });

        test('should update score to zero', () => {
            uiController.updateScore(0);
            expect(mockElements.scoreEl.textContent).toBe('0');
        });

        test('should update score with large numbers', () => {
            uiController.updateScore(999999);
            expect(mockElements.scoreEl.textContent).toBe('999999');
        });

        test('should convert score to string', () => {
            uiController.updateScore(500);
            expect(typeof mockElements.scoreEl.textContent).toBe('string');
        });
    });

    describe('updateLives', () => {
        test('should update lives display', () => {
            uiController.updateLives(2);
            expect(mockElements.livesEl.textContent).toBe('2');
        });

        test('should update lives to zero', () => {
            uiController.updateLives(0);
            expect(mockElements.livesEl.textContent).toBe('0');
        });

        test('should update lives with max lives', () => {
            uiController.updateLives(5);
            expect(mockElements.livesEl.textContent).toBe('5');
        });
    });

    describe('updateLevel', () => {
        test('should update level display', () => {
            uiController.updateLevel(3);
            expect(mockElements.levelEl.textContent).toBe('3');
        });

        test('should update level to one', () => {
            uiController.updateLevel(1);
            expect(mockElements.levelEl.textContent).toBe('1');
        });

        test('should update level with high levels', () => {
            uiController.updateLevel(10);
            expect(mockElements.levelEl.textContent).toBe('10');
        });
    });

    describe('updateHighScore', () => {
        test('should update high score display', () => {
            uiController.updateHighScore(5000);
            expect(mockElements.highScoreEl.textContent).toBe('5000');
        });

        test('should update high score to zero', () => {
            uiController.updateHighScore(0);
            expect(mockElements.highScoreEl.textContent).toBe('0');
        });
    });

    describe('showMenu', () => {
        test('should show menu element', () => {
            uiController.showMenu();
            expect(mockElements.menuEl.style.display).toBe('block');
        });

        test('should hide pause element when showing menu', () => {
            uiController.showMenu();
            expect(mockElements.pauseEl.style.display).toBe('none');
        });

        test('should hide game over element when showing menu', () => {
            uiController.showMenu();
            expect(mockElements.gameOverEl.style.display).toBe('none');
        });
    });

    describe('hideMenu', () => {
        test('should hide menu element', () => {
            uiController.hideMenu();
            expect(mockElements.menuEl.style.display).toBe('none');
        });
    });

    describe('showPause', () => {
        test('should show pause element', () => {
            uiController.showPause();
            expect(mockElements.pauseEl.style.display).toBe('block');
        });
    });

    describe('hidePause', () => {
        test('should hide pause element', () => {
            uiController.hidePause();
            expect(mockElements.pauseEl.style.display).toBe('none');
        });
    });

    describe('showGameOver', () => {
        test('should show game over element', () => {
            uiController.showGameOver(2500);
            expect(mockElements.gameOverEl.style.display).toBe('block');
        });

        test('should set final score in game over screen', () => {
            const mockFinalScoreEl = { textContent: '' };
            mockElements.gameOverEl.querySelector.mockReturnValue(mockFinalScoreEl);

            uiController.showGameOver(2500);

            expect(mockFinalScoreEl.textContent).toBe('2500');
        });

        test('should display zero score on game over', () => {
            const mockFinalScoreEl = { textContent: '' };
            mockElements.gameOverEl.querySelector.mockReturnValue(mockFinalScoreEl);

            uiController.showGameOver(0);

            expect(mockFinalScoreEl.textContent).toBe('0');
        });
    });

    describe('hideGameOver', () => {
        test('should hide game over element', () => {
            uiController.hideGameOver();
            expect(mockElements.gameOverEl.style.display).toBe('none');
        });
    });

    describe('showLevelComplete', () => {
        test('should create level complete message element', () => {
            uiController.showLevelComplete(2);
            expect(mockDocument.createElement).toHaveBeenCalledWith('div');
        });

        test('should set level complete message class', () => {
            uiController.showLevelComplete(2);
            const createdElement = mockDocument.createElement.mock.results[0].value;
            expect(createdElement.className).toBe('level-complete');
        });

        test('should set level complete message text', () => {
            uiController.showLevelComplete(2);
            const createdElement = mockDocument.createElement.mock.results[0].value;
            expect(createdElement.textContent).toBe('Level 2 Complete!');
        });

        test('should append level complete message to menu', () => {
            uiController.showLevelComplete(2);
            const createdElement = mockDocument.createElement.mock.results[0].value;
            expect(mockElements.menuEl.appendChild).toHaveBeenCalledWith(createdElement);
        });

        test('should show level complete for different levels', () => {
            uiController.showLevelComplete(5);
            const createdElement = mockDocument.createElement.mock.results[0].value;
            expect(createdElement.textContent).toBe('Level 5 Complete!');
        });
    });

    describe('updateHUD', () => {
        test('should update all HUD elements at once', () => {
            uiController.updateHUD({
                score: 1500,
                lives: 2,
                level: 3,
                highScore: 5000
            });

            expect(mockElements.scoreEl.textContent).toBe('1500');
            expect(mockElements.livesEl.textContent).toBe('2');
            expect(mockElements.levelEl.textContent).toBe('3');
            expect(mockElements.highScoreEl.textContent).toBe('5000');
        });

        test('should update HUD with partial data', () => {
            uiController.updateHUD({
                score: 1000
            });

            expect(mockElements.scoreEl.textContent).toBe('1000');
        });

        test('should update HUD with zero values', () => {
            uiController.updateHUD({
                score: 0,
                lives: 0,
                level: 1,
                highScore: 0
            });

            expect(mockElements.scoreEl.textContent).toBe('0');
            expect(mockElements.livesEl.textContent).toBe('0');
        });
    });

    describe('screen state management', () => {
        test('should transition from menu to game (hide menu)', () => {
            uiController.showMenu();
            expect(mockElements.menuEl.style.display).toBe('block');

            uiController.hideMenu();
            expect(mockElements.menuEl.style.display).toBe('none');
        });

        test('should transition from game to pause', () => {
            uiController.hideMenu();
            expect(mockElements.menuEl.style.display).toBe('none');

            uiController.showPause();
            expect(mockElements.pauseEl.style.display).toBe('block');
        });

        test('should transition from pause to game (hide pause)', () => {
            uiController.showPause();
            expect(mockElements.pauseEl.style.display).toBe('block');

            uiController.hidePause();
            expect(mockElements.pauseEl.style.display).toBe('none');
        });

        test('should transition from game to game over', () => {
            uiController.hideMenu();
            expect(mockElements.menuEl.style.display).toBe('none');

            uiController.showGameOver(1000);
            expect(mockElements.gameOverEl.style.display).toBe('block');
        });

        test('should transition from game over to menu', () => {
            uiController.showGameOver(1000);
            expect(mockElements.gameOverEl.style.display).toBe('block');

            uiController.showMenu();
            expect(mockElements.gameOverEl.style.display).toBe('none');
            expect(mockElements.menuEl.style.display).toBe('block');
        });

        test('should handle pause during game over (should not show pause)', () => {
            uiController.showGameOver(1000);
            uiController.showPause();
            
            // Pause –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∫–∞–∑–∞–Ω –ø–æ–≤–µ—Ä—Ö game over
            expect(mockElements.pauseEl.style.display).toBe('block');
        });
    });

    describe('button event listeners', () => {
        test('should register start button click listener', async () => {
            const startHandler = jest.fn();
            const UIControllerWithHandlers = (await import('../../src/presentation/UIController.js')).UIController;
            
            const controller = new UIControllerWithHandlers(mockDocument);
            controller.on('start', startHandler);
            
            expect(mockElements.startButton.addEventListener).toHaveBeenCalledWith(
                'click',
                expect.any(Function)
            );
        });

        test('should register restart button click listener', async () => {
            const restartHandler = jest.fn();
            const UIControllerWithHandlers = (await import('../../src/presentation/UIController.js')).UIController;
            
            const controller = new UIControllerWithHandlers(mockDocument);
            controller.on('restart', restartHandler);
            
            expect(mockElements.restartButton.addEventListener).toHaveBeenCalledWith(
                'click',
                expect.any(Function)
            );
        });
    });

    describe('event callbacks', () => {
        test('should call start callback when start button clicked', async () => {
            const startHandler = jest.fn();
            const UIControllerWithHandlers = (await import('../../src/presentation/UIController.js')).UIController;
            
            const controller = new UIControllerWithHandlers(mockDocument);
            controller.on('start', startHandler);
            
            // –ü–æ–ª—É—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            const clickHandler = mockElements.startButton.addEventListener.mock.calls[0][1];
            clickHandler({ preventDefault: jest.fn() });
            
            expect(startHandler).toHaveBeenCalled();
        });

        test('should call restart callback when restart button clicked', async () => {
            const restartHandler = jest.fn();
            const UIControllerWithHandlers = (await import('../../src/presentation/UIController.js')).UIController;
            
            const controller = new UIControllerWithHandlers(mockDocument);
            controller.on('restart', restartHandler);
            
            // –ü–æ–ª—É—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            const clickHandler = mockElements.restartButton.addEventListener.mock.calls[0][1];
            clickHandler({ preventDefault: jest.fn() });
            
            expect(restartHandler).toHaveBeenCalled();
        });

        test('should call preventDefault on button clicks', async () => {
            const startHandler = jest.fn();
            const UIControllerWithHandlers = (await import('../../src/presentation/UIController.js')).UIController;
            
            const controller = new UIControllerWithHandlers(mockDocument);
            controller.on('start', startHandler);
            
            const preventDefault = jest.fn();
            const clickHandler = mockElements.startButton.addEventListener.mock.calls[0][1];
            clickHandler({ preventDefault });
            
            expect(preventDefault).toHaveBeenCalled();
        });
    });

    describe('UI state visibility', () => {
        test('should have menu visible by default', () => {
            // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –º–µ–Ω—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–∏–º–æ
            expect(mockElements.menuEl.style.display).toBe('block');
        });

        test('should have pause hidden by default', () => {
            expect(mockElements.pauseEl.style.display).toBe('none');
        });

        test('should have game over hidden by default', () => {
            expect(mockElements.gameOverEl.style.display).toBe('none');
        });
    });
});

```


---
## Constraints ‚Äî strictly follow these

- src/tests/ is immutable after tdd_writer approval
- implementer must not modify test files under any circumstances
- RED phase must come before implementation - tests must fail first
- GREEN phase must be confirmed before review
- all ADR decisions in docs/design/architecture.md must be followed

---
## Your Task
PHASE GREEN: Read the tests in src/tests/phase_{phase}/ and write implementation that makes them pass. Do not modify any test files. Follow the architecture from docs/design/architecture.md. After implementing, specify the command to run tests.



**Save your output to:** `C:\Users\–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\Documents\projects\vibecraft_v0.3\test\src`